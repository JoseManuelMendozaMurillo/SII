{% extends "Layout/Template/admin.twig.html" %}

{% block title %} Admin{% endblock %}

{% block styles %}

<link rel="stylesheet" href="../Css/Admin/admin.css" />

{% endblock %}

{% block content %}

<div class="conatiner-fluid content-inner mt-n5 py-0">
    <div class="row">

        <div class="col-lg-12">
            <div id="warningAlert" class="alert alert-right alert-warning alert-dismissible fade show mb-3" role="alert"
                style="display: none;">
                <span>El archivo seleccionado no es una imagen, porfavor seleccione una imagen.</span>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="alert"
                    aria-label="Close"></button>
            </div>
        </div>

        <div class="col-lg-12">
            <div class="card">
                <div class="card-body  mx-4">
                    <h4>Configuraciónes</h4>
                    <div class="pt-3">
                        <nav>
                            <div class="nav nav-tabs mb-3" id="nav-tab" role="tablist">
                                <button class="nav-link active" id="nav-home-tab" data-bs-toggle="tab"
                                    data-bs-target="#nav-home" type="button" role="tab" aria-controls="nav-home"
                                    aria-selected="true">Cuentas</button>
                                <button class="nav-link" id="nav-profile-tab" data-bs-toggle="tab"
                                    data-bs-target="#nav-profile" type="button" role="tab" aria-controls="nav-profile"
                                    aria-selected="false">Personalización</button>
                            </div>
                        </nav>
                        <div class="tab-content" id="nav-tabContent">
                            <div class="tab-pane fade show active" id="nav-home" role="tabpanel"
                                aria-labelledby="nav-home-tab">
                                <p>Proximamente</p>
                            </div>
                            <div class="tab-pane fade" id="nav-profile" role="tabpanel"
                                aria-labelledby="nav-profile-tab">
                                <div class="row">
                                    <h5 class="pt-3 pb-3">Imagenes</h5>
                                    <div class="col-lg-6">
                                        <h6 class="pt-2 pb-2">Institución</h6>
                                        <div class="portfolio-item ">
                                            <div
                                                class="border border-2 text-center rounded position-relative overflow-hidden mb-2 min-alto ">
                                                <img id="logotec" class="img-fluid rounded "
                                                    src="../assets/images/imagenescorrecaminos/logotecocotlan.png "
                                                    alt="" style="height: 200px;">
                                                <div class="portfolio-btn d-grid align-items-center justify-content-center text-center"
                                                    style="background-color: #707070be;">
                                                    <div class="btn" type="button" data-bs-toggle="modal"
                                                        data-bs-target="#exampleModal" foto="logotec">
                                                        <h5 class="text-white p-1">400px x 400px</h5>
                                                        <img src="{{base_url('Vendor/Template/assets/images/imagenescorrecaminos/plus.svg')}}"
                                                            alt="add image" class="img-fluid p-4 bg-light"
                                                            style="height: 70px; width: auto; border-radius: 31px;">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <h6 class="pt-2 pb-2">Secretaria de educación </h6>
                                        <div class="portfolio-item ">
                                            <div
                                                class="border border-2 text-center rounded position-relative overflow-hidden mb-2 min-alto ">
                                                <img id="logosecretaria" class="img-fluid rounded "
                                                    src="../assets/images/imagenescorrecaminos/LOGO-SEP.svg " alt=""
                                                    style="height: 200px;">
                                                <div class="portfolio-btn d-grid align-items-center justify-content-center text-center"
                                                    style="background-color: #707070be;">
                                                    <div class="btn" type="button" data-bs-toggle="modal"
                                                        data-bs-target="#exampleModal" foto="logosecretaria">
                                                        <h5 class="text-white p-1">400px x 400px</h5>
                                                        <img src="{{base_url('Vendor/Template/assets/images/imagenescorrecaminos/plus.svg')}}"
                                                            alt="add image" class="img-fluid p-4 bg-light"
                                                            style="height: 70px; width: auto; border-radius: 31px;">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <h6 class="pt-2 pb-2">Tecnológico nacional de México </h6>
                                        <div class="portfolio-item ">
                                            <div
                                                class="border border-2 text-center rounded position-relative overflow-hidden mb-2 min-alto ">
                                                <img id="logotecnm" class="img-fluid rounded "
                                                    src="../assets/images/imagenescorrecaminos/Tecnologico nacional de mexico.png "
                                                    alt="" style="height: 200px;">
                                                <div class="portfolio-btn d-grid align-items-center justify-content-center text-center"
                                                    style="background-color: #707070be;">
                                                    <div class="btn" type="button" data-bs-toggle="modal"
                                                        data-bs-target="#exampleModal" foto="logotecnm">
                                                        <h5 class="text-white p-1">400px x 400px</h5>
                                                        <img src="{{base_url('Vendor/Template/assets/images/imagenescorrecaminos/plus.svg')}}"
                                                            alt="add image" class="img-fluid p-4 bg-light"
                                                            style="height: 70px; width: auto; border-radius: 31px;">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <h6 class="pt-2 pb-2">Pie de pagina</h6>
                                        <div class="portfolio-item ">
                                            <div
                                                class="border border-2 text-center rounded position-relative overflow-hidden mb-2 min-alto ">
                                                <img id="logopiepagina" class="img-fluid rounded "
                                                    src="../assets/images/imagenescorrecaminos/Imagen 6.svg " alt=""
                                                    style="height: 200px;">
                                                <div class="portfolio-btn d-grid align-items-center justify-content-center text-center"
                                                    style="background-color: #707070be;">
                                                    <div class="btn" type="button" data-bs-toggle="modal"
                                                        data-bs-target="#exampleModal" foto="logopiepagina">
                                                        <h5 class="text-white p-1">400px x 400px</h5>
                                                        <img src="{{base_url('Vendor/Template/assets/images/imagenescorrecaminos/plus.svg')}}"
                                                            alt="add image" class="img-fluid p-4 bg-light"
                                                            style="height: 70px; width: auto; border-radius: 31px;">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <h6 class="pt-2 pb-2">Qr de grupo de WhatsApp</h6>
                                        <div class="portfolio-item ">
                                            <div class="border border-2 text-center rounded position-relative overflow-hidden mb-2 min-alto "
                                                style="min-height: 200px;">
                                                <img id="logoqr" class="img-fluid rounded "
                                                    src="../assets/images/imagenescorrecaminos/Imagen 7.svg" alt=""
                                                    style="height: 200px;">
                                                <div class="portfolio-btn d-grid align-items-center justify-content-center text-center"
                                                    style="background-color: #707070be;">
                                                    <div class="btn" type="button" data-bs-toggle="modal"
                                                        data-bs-target="#exampleModal" foto="logoqr">
                                                        <h5 class="text-white p-1">400px x 400px</h5>
                                                        <img src="{{base_url('Vendor/Template/assets/images/imagenescorrecaminos/plus.svg')}}"
                                                            alt="add image" class="img-fluid p-4 bg-light"
                                                            style="height: 70px; width: auto; border-radius: 31px;">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row pt-3">
                                    <h5 class="pt-3 pb-3">Enlaces</h5>
                                    <div class="form-group col-md-6" bis_skin_checked="1">
                                        <label class="form-label" for="pass">Facebook: *</label>
                                        <input type="text" class="form-control" id="facebook"
                                            placeholder="https://facebook.com" value="https://facebook.com">
                                    </div>
                                    <div class="form-group col-md-6" bis_skin_checked="1">
                                        <label class="form-label" for="pass">Instagram: * </label>
                                        <input type="text" class="form-control" id="instagram"
                                            placeholder="https://instagram.com" value="https://instagram.com">
                                    </div>
                                    <div class="form-group col-md-6" bis_skin_checked="1">
                                        <label class="form-label" for="pass">Linkedin: * </label>
                                        <input type="text" class="form-control" id="linkedin"
                                            placeholder="https://linkedin.com" value="https://linkedin.com">
                                    </div>
                                    <div class="form-group col-md-6" bis_skin_checked="1">
                                        <label class="form-label" for="pass">Twitter: *</label>
                                        <input type="text" class="form-control" id="twitter"
                                            placeholder="https://twitter.com" value="https://twitter.com">
                                    </div>
                                    <div class="form-group col-md-6" bis_skin_checked="1">
                                        <label class="form-label" for="pass">TikTok: * </label>
                                        <input type="text" class="form-control" id="tiktok"
                                            placeholder="https://tiktok.com" value="https://tiktok.com">
                                    </div>
                                    <div class="form-group col-md-6" bis_skin_checked="1">
                                        <label class="form-label" for="pass">Grupo de whatsApp: * </label>
                                        <input type="text" class="form-control" id="whatsappgroup"
                                            placeholder="https://whatsapp.com" value="https://whatsapp.com">
                                    </div>
                                    <div class=" d-flex justify-content-end pt-3">
                                        <button id="cancelar" type="button" class="btn btn-danger ms-3 pl-2"
                                            style="display: none;">Cancelar</button>
                                        <button id="guardar" type="button" class="btn btn-primary ms-3"
                                            disabled>Guardar</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Cambiar imagen</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <label class="form-label">Selecciona una imagen: </label>
                    <div class="mb-3">
                        <input id="imageSelector" type="file" class="form-control form-control-lg"
                            aria-label="Large file input example">
                    </div>


                    <div id="imagencontenedor" class="docs-demo" bis_skin_checked="1" style="display: none;">
                        <div class="img-container" bis_skin_checked="1" style="width: 765px; height: 400px;">
                            <img id="image" src="images/picture.jpg" alt="Picture" class="cropper-hidden">
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-primary" id="cropButton"
                        data-bs-dismiss="modal">Seleccionar</button>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block script %}


<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.0/cropper.mi9n.js"
    integrity="sha512-7C1FbUL8fX5IKwBEHEjwyyGssfSOKms2NQbMj3GYdeQTr4Xmbrk/q/4eqcDuROAbJwT71ATVpVIUiaeMnNqq/Q=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script>


    let previewImage = document.getElementById('imagencontenedor');

    const imageSelector = document.getElementById('imageSelector');

    const imagesToUpdate = {
        logotec: logotec,
        logosecretaria: logosecretaria,
        logotecnm: logotecnm,
        logopiepagina: logopiepagina,
        logoqr: logoqr
    };

    const linksToUpdate = {
        facebook: facebook,
        instagram: instagram,
        linkedin: linkedin,
        twitter: twitter,
        tiktok: tiktok,
        whatsappgroup: whatsappgroup
    };

    const botonGuardar = document.getElementById('guardar');

    const botonCancelar = document.getElementById('cancelar');

    let currentFotoValue; // Variable para llevar el seguimiento del contexto de la imagen actual

    // Obtener el botón que abre el modal
    const openModalButtons = document.querySelectorAll('[data-bs-toggle="modal"]');

    // Agregar un evento clic a cada botón
    openModalButtons.forEach(function (button) {
        button.addEventListener('click', function () {
            // Obtener el valor del atributo "foto" del botón
            currentFotoValue = this.getAttribute('foto');

            // Imprimir el valor en la consola (para verificar el contexto)
            console.log('Valor del atributo "foto" del botón:', currentFotoValue);
        });
    });

    // Obtener todos los elementos de entrada con la clase "social-link-input"
    const inputElements = document.querySelectorAll('.form-control');

    // Definir una función para manejar cambios en los campos de entrada
    function handleInputChange(event) {
        const inputId = event.target.id;
        const inputValue = event.target.value;

        // Verificar si el elemento de entrada tiene una clave correspondiente en linksToUpdate
        if (linksToUpdate.hasOwnProperty(inputId)) {
            // Actualizar el valor en el objeto linksToUpdate
            linksToUpdate[inputId] = inputValue;
            previewImage.style.display = 'none';
            botonCancelar.style.display = "block"
            botonGuardar.removeAttribute('disabled');
            console.log(`Se actualizó ${inputId} a: ${inputValue}`);
        }
    }

    // Agregar un controlador de eventos de "input" a cada elemento de entrada
    inputElements.forEach((inputElement) => {
        inputElement.addEventListener('input', handleInputChange);
    });

    // Función para cerrar el modal
    function closeModal() {
        const activeModal = document.querySelector('.modal.show'); // Obtiene el modal activo
        if (activeModal) {
            const modalBackdrop = document.querySelector('.modal-backdrop'); // Obtiene el fondo del modal si es necesario

            // Cierra el modal activo
            activeModal.style.display = 'none';
            activeModal.classList.remove('show');

            // Remueve el fondo del modal si es necesario
            if (modalBackdrop) {
                modalBackdrop.remove();
            }
        }
    }

    imageSelector.addEventListener('change', (e) => {
        const imageFile = e.target.files[0];

        if (imageFile) {
            if (imageFile.type.startsWith('image/')) {
                const reader = new FileReader();

                reader.onload = function (e) {
                    // Obtén la imagen cargada y muestra la miniatura.
                    document.getElementById("image").src = e.target.result;
                    previewImage.style.display = 'block';
                    // Llama a la función initCropper después de que se haya renderizado la imagen
                    initCropper();
                };

                reader.readAsDataURL(imageFile);
            } else {
                // No es una imagen, muestra el mensaje de advertencia
                document.getElementById("warningAlert").style.display = 'block';
                closeModal(); //Cerramos el modal
                imageSelector.value = ""; // Limpiamos el input
                // No es una imagen, muestra un mensaje de error o realiza otra acción
                console.log('El archivo seleccionado no es una imagen');
            }
        }
    });
    function initCropper() {
        // Obtener imagen a recortar
        const image = document.getElementById('image');

        // Opciones de recorte
        const options = {
            aspectRatio: 16 / 9,
            crop(event) {
                console.log(event.detail);
            },
        };

        // Si ya existe un recortador previo, destrúyelo antes de crear uno nuevo
        if (window.cropper) {
            window.cropper.destroy();
        }

        // Inicializar recortador 
        window.cropper = new Cropper(image, options);

        // Recortar la imagen al hacer clic
        document.getElementById('cropButton').addEventListener('click', () => {
            const canvas = window.cropper.getCroppedCanvas();

            canvas.toBlob((blob) => {
                const img = document.createElement('img');
                img.src = URL.createObjectURL(blob);

                if (currentFotoValue in imagesToUpdate) {
                    const element = imagesToUpdate[currentFotoValue];
                    element.src = img.src;
                    previewImage.style.display = 'none';
                    botonCancelar.style.display = "block"
                    botonGuardar.removeAttribute('disabled');
                    imageSelector.value = "";
                }

            });
        });
    }

    botonCancelar.addEventListener('click', () => {
        imagesToUpdate.logotec.src = "../assets/images/imagenescorrecaminos/logotecocotlan.png "
        imagesToUpdate.logosecretaria.src = "../assets/images/imagenescorrecaminos/LOGO-SEP.svg "
        imagesToUpdate.logotecnm.src = "../assets/images/imagenescorrecaminos/Tecnologico nacional de mexico.png "
        imagesToUpdate.logopiepagina.src = "../assets/images/imagenescorrecaminos/Imagen 6.svg "
        imagesToUpdate.logoqr.src = "../assets/images/imagenescorrecaminos/Imagen 7.svg"
        document.getElementById('facebook').value = "https://facebook.com";
        document.getElementById('instagram').value = "https://instagram.com";
        document.getElementById('linkedin').value = "https://linkedin.com";
        document.getElementById('twitter').value = "https://twitter.com";
        document.getElementById('tiktok').value = "https://tiktok.com";
        document.getElementById('whatsappgroup').value = "https://whatsapp.com";
        /*linksToUpdate.facebook.value = "https://facebook.com";
        linksToUpdate.instagram.value = "https://instagram.com";
        linksToUpdate.linkedin.value = "https://linkedin.com";
        linksToUpdate.twitter.value = "https://twitter.com";
        linksToUpdate.tiktok.value = "https://tiktok.com";
        linksToUpdate.whatsappgroup = "https://whatsapp.com";*/
        botonGuardar.setAttribute('disabled', 'true');
        botonCancelar.style.display = 'none';
    });

</script>

{% endblock %}